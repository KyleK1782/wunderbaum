!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).mar10={})}(this,(function(e){"use strict";
/*!
     * persisto.js - utils
     * Copyright (c) 2021, Martin Wendt. Released under the MIT license.
     * v0.0.1-0, Thu, 04 Mar 2021 21:49:34 GMT (https://github.com/mar10/wunderbaum)
     */function t(e,t,i){switch("string"==typeof e&&(e=document.querySelector(e)),i){case!0:e.classList.add(t);break;case!1:e.classList.remove(t);break;default:e.classList.toggle(t)}}function i(e,t){if(!e)throw t=t||"Assertion failed.",new Error(t)}function n(){}
/*!
     * wunderbaum.ts
     *
     * A tree control.
     *
     * Copyright (c) 2021, Martin Wendt (https://wwWendt.de).
     * Released under the MIT license.
     *
     * @version v0.0.1-0
     * @date Thu, 04 Mar 2021 21:49:34 GMT
     */class s{constructor(e,t,n){this.refKey=void 0,this.children=null,this.lazy=!1,this.expanded=!1,this.selected=!1,this.statusNodeType="",this.subMatchCount=0,this.match=!1,this._rowIdx=0,this._rowElem=void 0,i(!t||t.tree===e),this.tree=e,this.parent=t,this.title=n.title||"?",this.key=void 0===n.key?""+ ++s.sequence:""+n.key}toString(){return"WunderbaumNode@"+this.key+"<'"+this.title+"'>"}getLevel(){let e=0,t=this.parent;for(;t;)e++,t=t.parent;return e}hasChildren(){if(this.lazy){if(null==this.children)return;if(0===this.children.length)return!1;if(1===this.children.length&&this.children[0].isStatusNode())return;return!0}return!(!this.children||!this.children.length)}isStatusNode(){return!!this.statusNodeType}visit(e,t=!1){let i,n,s=!0,r=this.children;if(!0===t&&(s=e(this),!1===s||"skip"===s))return s;if(r)for(i=0,n=r.length;i<n&&(s=r[i].visit(e,!0),!1!==s);i++);return s}visitParents(e,t=!1){if(t&&!1===e(this))return!1;let i=this.parent;for(;i;){if(!1===e(i))return!1;i=i.parent}return!0}visitSiblings(e,t=!1){let i,n,s,r=this.parent.children;for(i=0,n=r.length;i<n;i++)if(s=r[i],(t||s!==this)&&!1===e(s))return!1;return!0}setActive(t=!0){let i=this.tree.activeNode;this.tree.activeNode=this,null==i||i.setDirty(e.ChangeType.status),this.setDirty(e.ChangeType.status)}setExpanded(t=!0){this.expanded=t,this.setDirty(e.ChangeType.structure)}setDirty(e){this.render({})}render(e){let i,n,s=this._rowElem;if(s)t(s,"wb-expanded",!!this.expanded),t(s,"wb-lazy",!!this.lazy),t(s,"wb-selected",!!this.selected),t(s,"wb-active",this===this.tree.activeNode),n=s.querySelector("span.wb-title");else{let e,t;i=this.tree.nodeListElement,s=document.createElement("div"),s.classList.add("wb-row"),s._wb_node=this,this.expanded&&s.classList.add("wb-expanded"),this.lazy&&s.classList.add("wb-lazy"),this.selected&&s.classList.add("wb-selected"),t=document.createElement("span"),t.classList.add("wb-node","wb-col"),s.appendChild(t),e=document.createElement("i"),e.classList.add("wb-checkbox"),e.classList.add("bi","bi-check2-square"),t.appendChild(e);for(let i=this.getLevel();i>0;i--)e=document.createElement("i"),e.classList.add("wb-indent"),t.appendChild(e);e=document.createElement("i"),e.classList.add("wb-expander"),e.classList.add("bi","bi-dash-square"),t.appendChild(e),e=document.createElement("i"),e.classList.add("wb-icon"),e.classList.add("bi","bi-folder"),t.appendChild(e),n=document.createElement("span"),n.classList.add("wb-title"),t.appendChild(n)}s.style.top=16*this._rowIdx+"px",n.textContent=this.title,this._rowElem||(this._rowElem=s,i.appendChild(s))}addChild(e,t){null==this.children?this.children=[e]:t?i(!1):this.children.push(e)}}s.sequence=0;var r;e.ChangeType=void 0,(r=e.ChangeType||(e.ChangeType={})).any="any",r.structure="structure",r.status="status";class l{constructor(e){this.keyMap={},this.refKeyMap={},this.rows=[],this.activeNode=null,this.enableFilter=!1,this._enableUpdate=!0;let t=this.opts=function(...e){for(let t=1;t<e.length;t++){let i=e[t];for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[0][t]=i[t])}return e[0]}({source:null,element:null,debugLevel:1,change:n,error:n,receive:n},e);var i,r,d,o,a;this.name=t.name||"wb_"+ ++l.sequence,this.root=new s(this,null,{key:"__root__",name:"__root__"}),"string"==typeof t.element?this.element=document.querySelector(t.element):this.element=t.element,this.treeElement=this.element.querySelector("div.wunderbaum"),this.scrollContainer=this.treeElement.querySelector("div.wb-scroll-container"),this.nodeListElement=this.scrollContainer.querySelector("div.wb-node-list"),this.nodeListElement.textContent="",this.nodeListElement||alert("TODO: create markup"),t.source&&this.load(t.source),this.scrollContainer.addEventListener("scroll",(e=>{this.updateViewport()})),i=this.nodeListElement,r="click",d="span.wb-node",o=e=>{var t;null===(t=this.getNode(e))||void 0===t||t.setActive(),this.log("click")},"string"==typeof i&&(i=document.querySelector(i)),i.addEventListener(r,(function(e){if(e.target&&e.target.matches(d))return a?o.call(a,e):o(e)}))}static getTree(){}getNode(e){if(this.log("getNode",e),e instanceof Event&&(e=e.target),e instanceof Element){let t=e.closest("div.wb-row");return this.log("getNode",t),t._wb_node}return null}debug(...e){this.opts.debugLevel>=4&&(Array.prototype.unshift.call(e,this.toString()),console.log.apply(console,e))}toString(){return"Wunderbaum<'"+this.name+"'>"}log(...e){this.opts.debugLevel>=1&&(Array.prototype.unshift.call(e,this.toString()),console.log.apply(console,e))}logTime(e){return this.opts.debugLevel>=1&&console.time(e),e}logTimeEnd(e){this.opts.debugLevel>=1&&console.timeEnd(e)}renumber(e){let t=this.logTime("renumber"),n=0,s=0,r=!1,l=e.startIdx,d=e.endIdx;return this.debug("render",e),i(null!=l&&null!=d),this.root.children[1].expanded=!0,this.visitRows((function(e){let t=e._rowIdx;t!==n&&(e._rowIdx=n,r=!0),n<l||n>d?e._rowElem&&(e._rowElem.remove(),e._rowElem=void 0):e._rowElem&&t==n||e.render({top:s}),n++,s+=16})),this.nodeListElement.style.height=s+"px",this.logTimeEnd(t),r}updateViewport(){let e=this.scrollContainer.clientHeight,t=this.scrollContainer.scrollTop;this.renumber({startIdx:Math.max(0,t/16-5),endIdx:Math.max(0,(t+e)/16+5)})}visit(e){return this.root.visit(e,!1)}visitRows(e,t){if(!this.root.hasChildren())return!1;if(t&&t.reverse)return delete t.reverse,this._visitRowsUp(e,t);let n,s,r,l,d,o=0,a=!1===(t=t||{}).includeSelf,h=!!t.includeHidden,c=!h&&this.enableFilter,u=t.start||this.root.children[0];for(r=u.parent;r;){for(d=r.children,s=d.indexOf(u)+o,i(s>=0,"Could not find "+u+" in parent's children: "+r),n=s;n<d.length;n++)if(u=d[n],!c||u.match||u.subMatchCount){if(!a&&!1===e(u))return!1;if(a=!1,u.children&&u.children.length&&(h||u.expanded)&&(l=u.visit((function(t){return!c||t.match||t.subMatchCount?!1!==e(t)&&(h||!t.children||t.expanded?void 0:"skip"):"skip"}),!1),!1===l))return!1}u=r,r=r.parent,o=1}return!0}_visitRowsUp(e,t){for(var i,n,s,r=!!t.includeHidden,l=t.start||this.root.children[0];;){if((i=(s=l.parent).children)[0]===l){if(!(l=s).parent)break;i=s.children}else for(n=i.indexOf(l),l=i[n-1];(r||l.expanded)&&l.children&&l.children.length;)s=l,l=(i=l.children)[i.length-1];if(r||l.isVisible()){if(!1===e(l))return!1;break}}return!0}load(e){return this._load(this.root,e)}addChildren(t,n){var r;i((r=n,Array.isArray(r)));for(let e=0;e<n.length;e++){let i=n[e],r=new s(this,t,i);t.addChild(r),i.children&&this.addChildren(r,i.children)}this.setModified(t,e.ChangeType.structure)}enableUpdate(e){return e=!1!==e,!!this._enableUpdate==!!e?e:(this._enableUpdate=e,e?(this.debug("enableUpdate(true): redraw "),this.updateViewport()):this.debug("enableUpdate(false)..."),!e)}setModified(e,t){}_load(e,t){let i=this.opts;i.debugLevel>=2&&console.time&&console.time(this+"._load");let n=this;return new Promise((function(t,s){fetch(i.source,{method:"GET"}).then((function(e){return e.ok?i.receive.call(n,e):function(e){throw new Error(e)}("GET "+i.remote+" returned "+e.status+", "+e),e.json()})).then((function(i){let s=n.enableUpdate(!1);n.addChildren.call(n,e,i),n.enableUpdate(s),t(e)})).catch((function(){console.error(arguments),s(e),i.error.call(n,arguments)})).finally((function(){i.debugLevel>=2&&console.time&&console.timeEnd(n+"._load")}))}))}}l.version="v0.0.1-0",l.sequence=0,e.Wunderbaum=l,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=wunderbaum.umd.min.js.map