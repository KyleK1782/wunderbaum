!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).mar10={})}(this,(function(e){"use strict";
/*!
     * wunderbaum.js - utils
     * Copyright (c) 2021, Martin Wendt. Released under the MIT license.
     * v0.0.1-0, @DATE (https://github.com/mar10/wunderbaum)
     */function t(e,t){if(!e)throw t=t||"Assertion failed.",new Error(t)}function i(){}
/*!
     * wunderbaum.js - common
     * Copyright (c) 2021, Martin Wendt. Released under the MIT license.
     * v0.0.1-0, @DATE (https://github.com/mar10/wunderbaum)
     */var n,r;!function(e){e.any="any",e.structure="structure",e.status="status"}(n||(n={})),function(e){e.unknown="",e.title="title",e.icon="icon",e.expander="expander",e.checkbox="checkbox",e.prefix="prefix"}(r||(r={}));
/*!
     * wunderbaum.js - wunderbaum_node
     * Copyright (c) 2021, Martin Wendt. Released under the MIT license.
     * v0.0.1-0, @DATE (https://github.com/mar10/wunderbaum)
     */
class s{constructor(e,i,n){this.refKey=void 0,this.children=null,this.lazy=!1,this.expanded=!1,this.selected=!1,this.statusNodeType="",this.subMatchCount=0,this.match=!1,this._rowIdx=0,this._rowElem=void 0,t(!i||i.tree===e),this.tree=e,this.parent=i,this.title=n.title||"?",this.key=void 0===n.key?""+ ++s.sequence:""+n.key}toString(){return"WunderbaumNode@"+this.key+"<'"+this.title+"'>"}addChild(e,i){null==this.children?this.children=[e]:i?t(!1):this.children.push(e)}getLevel(){let e=0,t=this.parent;for(;t;)e++,t=t.parent;return e}hasChildren(){if(this.lazy){if(null==this.children)return;if(0===this.children.length)return!1;if(1===this.children.length&&this.children[0].isStatusNode())return;return!0}return!(!this.children||!this.children.length)}isActive(){return this.tree.activeNode===this}isExpandable(){return this.children}isExpanded(){return!!this.expanded}isSelected(){return!!this.selected}isStatusNode(){return!!this.statusNodeType}removeMarkup(){this._rowElem&&(delete this._rowElem._wb_node,this._rowElem.remove(),this._rowElem=void 0)}render(e){let t,i,n,r,s,l,o,d=this._rowElem,a="bi bi-dash-square",h="bi bi-plus-square",c="bi bi-check-square",u="bi bi-square",p="bi bi-folder2",b="bi bi-folder2-open",f="bi bi-file-earmark",m=["wb-row"];if(this.expanded&&m.push("wb-expanded"),this.lazy&&m.push("wb-lazy"),this.selected&&m.push("wb-selected"),this===this.tree.activeNode&&m.push("wb-active"),d)r=d.querySelector("span.wb-title"),o=d.querySelector("i.wb-expander"),s=d.querySelector("i.wb-checkbox"),l=d.querySelector("i.wb-icon");else{n=this.tree.nodeListElement,d=document.createElement("div"),d._wb_node=this,i=document.createElement("span"),i.classList.add("wb-node","wb-col"),d.appendChild(i),s=document.createElement("i"),i.appendChild(s);for(let e=this.getLevel()-1;e>0;e--)t=document.createElement("i"),t.classList.add("wb-indent"),i.appendChild(t);o=document.createElement("i"),i.appendChild(o),l=document.createElement("i"),i.appendChild(l),r=document.createElement("span"),r.classList.add("wb-title"),i.appendChild(r)}d.className=m.join(" "),d.style.top=22*this._rowIdx+"px",o&&(this.isExpandable()?this.expanded?o.className="wb-expander "+a:o.className="wb-expander "+h:o.classList.add("wb-indent")),s&&(this.selected?s.className="wb-checkbox "+c:s.className="wb-checkbox "+u),l&&(this.expanded?l.className="wb-icon "+b:this.children?l.className="wb-icon "+p:l.className="wb-icon "+f),r.textContent=this.title,this._rowElem||(this._rowElem=d,n.appendChild(d))}setActive(e=!0){let t=this.tree.activeNode;this.tree.activeNode=this,null==t||t.setDirty(n.status),this.setDirty(n.status)}setDirty(e){e===n.structure?this.tree.updateViewport():this._rowElem&&this.render({})}setExpanded(e=!0){this.expanded=e,this.setDirty(n.structure)}setSelected(e=!0){this.selected=e,this.setDirty(n.status)}visit(e,t=!1){let i,n,r=!0,s=this.children;if(!0===t&&(r=e(this),!1===r||"skip"===r))return r;if(s)for(i=0,n=s.length;i<n&&(r=s[i].visit(e,!0),!1!==r);i++);return r}visitParents(e,t=!1){if(t&&!1===e(this))return!1;let i=this.parent;for(;i;){if(!1===e(i))return!1;i=i.parent}return!0}visitSiblings(e,t=!1){let i,n,r,s=this.parent.children;for(i=0,n=s.length;i<n;i++)if(r=s[i],(t||r!==this)&&!1===e(r))return!1;return!0}}s.sequence=0;
/*!
     * wunderbaum.ts
     *
     * A tree control.
     *
     * Copyright (c) 2021, Martin Wendt (https://wwWendt.de).
     * Released under the MIT license.
     *
     * @version v0.0.1-0
     * @date @DATE
     */
class l{constructor(e){this.keyMap={},this.refKeyMap={},this.viewNodes=new Set,this.rows=[],this.activeNode=null,this.enableFilter=!1,this._enableUpdate=!0;let t=this.opts=function(...e){for(let t=1;t<e.length;t++){let i=e[t];for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[0][t]=i[t])}return e[0]}({source:null,element:null,debugLevel:1,change:i,error:i,receive:i},e);var n,o,d,a;this.name=t.name||"wb_"+ ++l.sequence,this.root=new s(this,null,{key:"__root__",name:"__root__"}),"string"==typeof t.element?this.element=document.querySelector(t.element):this.element=t.element,this.treeElement=this.element.querySelector("div.wunderbaum"),this.scrollContainer=this.treeElement.querySelector("div.wb-scroll-container"),this.nodeListElement=this.scrollContainer.querySelector("div.wb-node-list"),this.nodeListElement.textContent="",this.nodeListElement||alert("TODO: create markup"),t.source&&this.load(t.source),this.scrollContainer.addEventListener("scroll",(e=>{this.updateViewport()})),n=this.nodeListElement,o="click",d="span.wb-node",a=e=>{var t,i;let n=this.getEventTarget(e);n.node.setActive(),n.type===r.expander&&(null===(t=n.node)||void 0===t||t.setExpanded(!n.node.isExpanded())),n.type===r.checkbox&&(null===(i=n.node)||void 0===i||i.setSelected(!n.node.isSelected())),this.log("click",n)},"string"==typeof n&&(n=document.querySelector(n)),n.addEventListener(o,(function(e){if(e.target){let t=e.target;if(t.matches(d))return a(e);if(t=t.closest(d),t)return a(e)}}))}static getTree(){}static getNode(e){if(e instanceof Event&&(e=e.target),e instanceof Element){return e.closest("div.wb-row")._wb_node}return null}getEventTarget(e){let t=e.target.classList,i=l.getNode(e.target),n={node:i,type:r.unknown};return t.contains("wb-title")?n.type=r.title:t.contains("wb-expander")?n.type=!1===i.hasChildren()?r.prefix:r.expander:t.contains("wb-checkbox")?n.type=r.checkbox:t.contains("wb-icon")||t.contains("wb-custom-icon")?n.type=r.icon:t.contains("wb-node")&&(n.type=r.title),n}getEventTargetType(e){return this.getEventTarget(e).type}debug(...e){this.opts.debugLevel>=4&&(Array.prototype.unshift.call(e,this.toString()),console.log.apply(console,e))}toString(){return"Wunderbaum<'"+this.name+"'>"}log(...e){this.opts.debugLevel>=1&&(Array.prototype.unshift.call(e,this.toString()),console.log.apply(console,e))}logTime(e){return this.opts.debugLevel>=1&&console.time(e),e}logTimeEnd(e){this.opts.debugLevel>=1&&console.timeEnd(e)}render(e){let i=this.logTime("render"),n=0,r=0,s=!1,l=e.startIdx,o=e.endIdx,d=this.viewNodes;this.viewNodes=new Set;let a=this.viewNodes;t(null!=l&&null!=o),this.visitRows((function(e){let t=e._rowIdx;a.add(e),d.delete(e),t!==n&&(e._rowIdx=n,s=!0),n<l||n>o?e.removeMarkup():e.render({top:r}),n++,r+=22}));for(let e of d)e.removeMarkup();return this.nodeListElement.style.height=r+"px",this.logTimeEnd(i),s}updateViewport(){let e=this.scrollContainer.clientHeight,t=this.scrollContainer.scrollTop;this.render({startIdx:Math.max(0,t/22-5),endIdx:Math.max(0,(t+e)/22+5)})}visit(e){return this.root.visit(e,!1)}visitRows(e,i){if(!this.root.hasChildren())return!1;if(i&&i.reverse)return delete i.reverse,this._visitRowsUp(e,i);let n,r,s,l,o,d=0,a=!1===(i=i||{}).includeSelf,h=!!i.includeHidden,c=!h&&this.enableFilter,u=i.start||this.root.children[0];for(s=u.parent;s;){for(o=s.children,r=o.indexOf(u)+d,t(r>=0,"Could not find "+u+" in parent's children: "+s),n=r;n<o.length;n++)if(u=o[n],!c||u.match||u.subMatchCount){if(!a&&!1===e(u))return!1;if(a=!1,u.children&&u.children.length&&(h||u.expanded)&&(l=u.visit((function(t){return!c||t.match||t.subMatchCount?!1!==e(t)&&(h||!t.children||t.expanded?void 0:"skip"):"skip"}),!1),!1===l))return!1}u=s,s=s.parent,d=1}return!0}_visitRowsUp(e,t){let i,n,r,s=!!t.includeHidden,l=t.start||this.root.children[0];for(;;){if(r=l.parent,i=r.children,i[0]===l){if(l=r,!l.parent)break;i=r.children}else for(n=i.indexOf(l),l=i[n-1];(s||l.expanded)&&l.children&&l.children.length;)i=l.children,r=l,l=i[i.length-1];if(s||l.isVisible()){if(!1===e(l))return!1;break}}return!0}load(e){return this._load(this.root,e)}addChildren(e,i){var r;t((r=i,Array.isArray(r)));for(let t=0;t<i.length;t++){let n=i[t],r=new s(this,e,n);e.addChild(r),n.children&&this.addChildren(r,n.children)}this.setModified(e,n.structure)}enableUpdate(e){return e=!1!==e,!!this._enableUpdate==!!e?e:(this._enableUpdate=e,e?(this.debug("enableUpdate(true): redraw "),this.updateViewport()):this.debug("enableUpdate(false)..."),!e)}setModified(e,t){}_load(e,t){let i=this.opts;i.debugLevel>=2&&console.time&&console.time(this+"._load");let n=this;return new Promise((function(t,r){fetch(i.source,{method:"GET"}).then((function(e){return e.ok?i.receive.call(n,e):function(e){throw new Error(e)}("GET "+i.remote+" returned "+e.status+", "+e),e.json()})).then((function(i){let r=n.enableUpdate(!1);n.addChildren.call(n,e,i),n.enableUpdate(r),t(e)})).catch((function(){console.error(arguments),r(e),i.error.call(n,arguments)})).finally((function(){i.debugLevel>=2&&console.time&&console.timeEnd(n+"._load")}))}))}}l.version="v0.0.1-0",l.sequence=0,e.Wunderbaum=l,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=wunderbaum.umd.min.js.map